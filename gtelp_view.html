<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>G-TELP 채용정보 허브</title>
<style>
body{font-family:'Segoe UI', Tahoma, sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}
.container{max-width:1400px;margin:0 auto}
.header{background:white;padding:30px;border-radius:20px;box-shadow:0 10px 40px rgba(0,0,0,0.1);text-align:center;margin-bottom:30px}
.header h1{color:#667eea;font-size:2.5em;margin-bottom:10px}
.header p{color:#666;font-size:1.1em}
.jobs-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:20px}
.job-card{background:white;padding:25px;border-radius:15px;box-shadow:0 5px 20px rgba(0,0,0,0.1);transition:0.3s}
.job-card:hover{transform:translateY(-5px)}
.job-title{font-weight:600;color:#333;font-size:1.2em}
.job-company{color:#667eea;font-weight:600;margin:8px 0}
.job-tag{background:#f0f4ff;color:#667eea;padding:5px 10px;border-radius:20px;font-size:0.85em;margin-right:5px}
.job-link{display:inline-block;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:8px 16px;border-radius:25px;text-decoration:none;font-weight:600}
.job-link:active,.job-link:focus{outline:none}
.btn-disabled{display:inline-block;padding:8px 16px;border-radius:25px;background:#eee;color:#999;border:1px solid #ddd;font-weight:600}
.small-search{display:inline-block;margin-left:8px;padding:6px 12px;border-radius:18px;background:#f0f4ff;color:#667eea;text-decoration:none;border:1px solid #dfe8ff;font-weight:600;font-size:0.9em}
.no-data{background:white;padding:50px;border-radius:15px;text-align:center;box-shadow:0 5px 20px rgba(0,0,0,0.1)}
@media(max-width:768px){.jobs-grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>🌟 G-TELP 채용정보 허브</h1>
    <p>지텔프 관련 최신 채용 공고를 한눈에 확인하세요</p>
  </div>

  <div class="jobs-grid" id="jobsGrid">
    <div class="no-data">
      <h3>📋 채용정보를 불러오는 중...</h3>
      <p style="color:#666">잠시만 기다려주세요.</p>
    </div>
  </div>
</div>

<script>
async function loadJobs(){
  const grid = document.getElementById('jobsGrid');
  try {
    const res = await fetch('gtelp_data.json', {cache: "no-store"});
    if(!res.ok) throw new Error('데이터 파일을 불러올 수 없습니다.');
    const jobs = await res.json();

    grid.innerHTML = jobs.map(job => {
      const title = job.job_title || job['제목'] || job['공고명'] || '제목 없음';
      const company = job.company_name || job['회사명'] || job['기업명'] || '회사명 미상';
      const location = job.location || job['위치'] || job['지역'] || '전국';
      const site = job.source_site || job['출처'] || job['사이트'] || '출처 미상';

      // 모든 가능한 링크 필드 우선순위: (원본값을 최대한 유지)
      let orig = job.job_url ?? job['Job_url'] ?? job['JOB_URL'] ?? job['jobUrl'] ?? job['url'] ?? job['URL'] ?? job['Url'] ??
                 job['링크'] ?? job['채용링크'] ?? job['상세링크'] ?? job['지원링크'] ?? job['채용URL'] ?? job['주소'] ?? job['웹사이트'] ?? '';

      orig = (typeof orig === 'object' && orig !== null && orig.Target) ? orig.Target : orig; // 엑셀 하이퍼링크 처리

      // trim
      orig = (orig || '').toString().trim();

      // 자동 보정: http/https가 없으면 붙이되, 만약 값이 단순 키워드(공백 등)면 붙이지 않음
      let url = '';
      if(orig){
        // 이미 http(s)로 시작하면 그대로 사용
        if(/^https?:\/\//i.test(orig)){
          url = orig;
        } else {
          // orig이 도메인이나 경로처럼 보이면 https 붙여서 직접 연결
          // 판단 기준: '.' 포함 (example.com) 또는 '/'로 시작하는 경로
          if(orig.includes('.') || orig.startsWith('/')){
            url = (orig.startsWith('//') ? 'https:' + orig : 'https://' + orig.replace(/^\/+/, ''));
          } else {
            // 단어만 들어온 경우(예: "지원링크 없음" 같은 값)라면 url으로 보지 않음
            url = '';
          }
        }
      }

      // 링크 HTML: 링크가 있으면 바로가기 버튼(직접 링크), 없으면 비활성 버튼 + 선택적 검색링크
      let linkHtml = '';
      if(url){
        // 안전하게 HTML 이스케이프 해줄 필요가 있으나 여기선 템플릿으로 바로 삽입
        linkHtml = `<a class="job-link" href="${escapeHtml(url)}" target="_blank" rel="noopener noreferrer">자세히 보기 →</a>`;
      } else {
        // 링크가 없을 때: '링크 없음' 버튼(비활성) + 작게 구글 검색(선택적)
        const searchTerm = encodeURIComponent((company || '') + ' ' + (title || ''));
        linkHtml = `<span class="btn-disabled">링크 없음</span>
                    <a class="small-search" href="https://www.google.com/search?q=${searchTerm}" target="_blank" rel="noopener noreferrer">🔍 검색</a>`;
      }

      return `
        <div class="job-card">
          <div class="job-title">${escapeHtml(title)}</div>
          <div class="job-company">🏢 ${escapeHtml(company)}</div>
          <div style="margin:8px 0 12px 0;">
            <span class="job-tag">📍 ${escapeHtml(location)}</span>
            <span class="job-tag">💼 ${escapeHtml(site)}</span>
          </div>
          <div>${linkHtml}</div>
        </div>
      `;
    }).join('');
  } catch(err){
    console.error(err);
    grid.innerHTML = `<div class="no-data"><h3>⚠️ 채용정보를 불러오지 못했습니다</h3><p style="color:#666">관리자가 데이터를 업로드하지 않았을 수 있습니다.</p></div>`;
  }
}

function escapeHtml(text){
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

loadJobs();
</script>
</body>
</html>
